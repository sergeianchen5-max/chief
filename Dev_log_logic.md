# Dev Log ‚Äî –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ¬´–®–µ—Ñ-–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫¬ª

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2026-02-23
**–í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** 2.0 (Next.js 16 + Supabase)

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#1-–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–ü–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –º–æ–¥—É–ª–µ–π](#2-–ø–æ—à–∞–≥–æ–≤–∞—è-–ª–æ–≥–∏–∫–∞-–º–æ–¥—É–ª–µ–π)
   - [2.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è](#21-—Ç–æ—á–∫–∞-–≤—Ö–æ–¥–∞-–∏-–Ω–∞–≤–∏–≥–∞—Ü–∏—è-srcapppagets—Ö)
   - [2.2 –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ Middleware](#22-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-–∏-middleware)
   - [2.3 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö](#23-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è-–¥–∞–Ω–Ω—ã—Ö-usesupbasesyncts)
   - [2.4 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤ (AI)](#24-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-—Ä–µ—Ü–µ–ø—Ç–æ–≤-ai-generatets)
   - [2.5 –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ (Vision)](#25-—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ-–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤-visionts)
   - [2.6 –û–ø–ª–∞—Ç–∞ –∏ –ø–æ–¥–ø–∏—Å–∫–∏](#26-–æ–ø–ª–∞—Ç–∞-–∏-–ø–æ–¥–ø–∏—Å–∫–∏-paymentts)
   - [2.7 –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫](#27-—Å–ø–∏—Å–æ–∫-–ø–æ–∫—É–ø–æ–∫-shoppingts)
   - [2.8 –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è](#28-–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å-–∏-–º–æ–¥–µ—Ä–∞—Ü–∏—è-admints)
   - [2.9 –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ WordPress](#29-–ø—É–±–ª–∏–∫–∞—Ü–∏—è-–≤-wordpress-wordpressts)
   - [2.10 –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ](#210-–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ-hashts)
   - [2.11 Rate Limiting](#211-rate-limiting-ratelimitts)
3. [–ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã](#3-–Ω–∞–π–¥–µ–Ω–Ω—ã–µ-–æ—à–∏–±–∫–∏-–∏-–ø—Ä–æ–±–ª–µ–º—ã)
4. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é](#4-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-—É–ª—É—á—à–µ–Ω–∏—é)

---

## 1. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç–µ–∫

| –°–ª–æ–π | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|---|---|
| Frontend/Backend | Next.js 16.1.6 (App Router, `use client` / `use server`) |
| –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è | Tailwind CSS 4, —à—Ä–∏—Ñ—Ç Montserrat |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | Supabase (PostgreSQL + Auth + RLS) |
| AI (–æ—Å–Ω–æ–≤–Ω–æ–π) | Google Gemini 2.5 Flash (—á–µ—Ä–µ–∑ REST API + –ø—Ä–æ–∫—Å–∏) |
| AI (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π) | OpenRouter (gemini-1.5-flash, llama-3, phi-3) |
| –û–ø–ª–∞—Ç–∞ | YooKassa (RUB) |
| Rate Limiting | Upstash Redis (—Å–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ) |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | Sentry |
| –î–µ–ø–ª–æ–π | Vercel |
| CMS | WordPress (REST API –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤) |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx              # –ì–ª–∞–≤–Ω–∞—è SPA-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–∞–±–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx            # –ö–æ—Ä–Ω–µ–≤–æ–π layout (Montserrat, metadata, PWA)
‚îÇ   ‚îú‚îÄ‚îÄ globals.css           # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ actions/              # Server Actions (9 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generate.ts       # AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.ts          # –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment.ts        # –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ YooKassa
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shopping.ts       # –°–ø–∏—Å–∫–∏ –ø–æ–∫—É–ø–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vision.ts         # –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ wordpress.ts      # –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ WordPress
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ unsplash.ts       # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ —Ä–µ—Ü–µ–ø—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ proxy.ts          # HTTP-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –≥–µ–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ admin/                # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ auth/                 # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (OAuth + –ø–∞—Ä–æ–ª—å)
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/            # –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ pricing/              # –¢–∞—Ä–∏—Ñ—ã
‚îÇ   ‚îú‚îÄ‚îÄ recipe/               # –ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ—Ü–µ–ø—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cron/             # Cron-–∑–∞–¥–∞—á–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhooks/         # –í–µ–±—Ö—É–∫–∏ (YooKassa)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test-gen/         # –¢–µ—Å—Ç–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ sitemap.ts            # SEO sitemap
‚îú‚îÄ‚îÄ components/               # UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (7 –ø–∞–Ω–µ–ª–µ–π)
‚îÇ   ‚îú‚îÄ‚îÄ ChefPanel.tsx         # –ü–∞–Ω–µ–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ FridgePanel.tsx       # –ü–∞–Ω–µ–ª—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ
‚îÇ   ‚îú‚îÄ‚îÄ FamilyPanel.tsx       # –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–º—å—ë–π
‚îÇ   ‚îú‚îÄ‚îÄ RecipeBasePanel.tsx   # –ë–∞–∑–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ShoppingListPanel.tsx # –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ PWAInstallBanner.tsx  # –ë–∞–Ω–Ω–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
‚îÇ   ‚îî‚îÄ‚îÄ CookieBanner.tsx      # –ë–∞–Ω–Ω–µ—Ä —Å–æ–≥–ª–∞—Å–∏—è —Å cookies
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ types.ts              # TypeScript —Ç–∏–ø—ã –∏ enum'—ã
‚îÇ   ‚îú‚îÄ‚îÄ schemas.ts            # Zod-—Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ hash.ts               # MD5-—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ratelimit.ts          # Rate limiting (Upstash)
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useUser.ts        # –•—É–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useSupabaseSync.ts# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è localStorage ‚Üî Supabase
‚îÇ   ‚îî‚îÄ‚îÄ supabase/
‚îÇ       ‚îú‚îÄ‚îÄ client.ts         # –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–ª–∏–µ–Ω—Ç Supabase
‚îÇ       ‚îú‚îÄ‚îÄ server.ts         # –°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–ª–∏–µ–Ω—Ç Supabase
‚îÇ       ‚îú‚îÄ‚îÄ middleware.ts     # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
‚îÇ       ‚îî‚îÄ‚îÄ db.ts             # CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ (inventory, family, recipes)
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ generationService.ts  # –û–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ server action –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ middleware.ts             # Next.js middleware (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Supabase —Å–µ—Å—Å–∏–∏)
```

---

## 2. –ü–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –º–æ–¥—É–ª–µ–π

### 2.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è (`src/app/page.tsx`)

**–¢–∏–ø:** `'use client'` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è SPA-—Å—Ç—Ä–∞–Ω–∏—Ü–∞.

**–ü–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**

1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `Home` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `useUser()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `useSupabaseSync()` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (inventory, family, savedRecipes) –∏–∑ localStorage –∏–ª–∏ Supabase.
3. –ü–æ–∫–∞ `isLoaded === false`, —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –ø—É—Å—Ç–æ–π div (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏).
4. –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è SPA —Å 5 —Ç–∞–±–∞–º–∏:
   - **–®–µ—Ñ-–ø–æ–≤–∞—Ä** (`ChefPanel`) ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
   - **–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫** (`FridgePanel`) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
   - **–°–µ–º—å—è** (`FamilyPanel`) ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ —Å–µ–º—å–∏
   - **–†–µ—Ü–µ–ø—Ç—ã** (`RecipeBasePanel`) ‚Äî —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
   - **–ü–æ–∫—É–ø–∫–∏** (`ShoppingListPanel`) ‚Äî —Å–ø–∏—Å–∫–∏ –ø–æ–∫—É–ø–æ–∫
5. –°–æ—Å—Ç–æ—è–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (`chefPlan`, `generationState`, `selectedCategories`, `errorMessage`) **–ø–æ–¥–Ω—è—Ç–æ** –≤ `Home`, —á—Ç–æ–±—ã –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª–æ—Å—å –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ç–∞–±–æ–≤.
6. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ—Ü–µ–ø—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –≤ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫.

**Layout:**
- –ú–æ–±–∏–ª—å–Ω—ã–π: –Ω–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π ¬´Action¬ª –∫–Ω–æ–ø–∫–æ–π —à–µ—Ñ-–ø–æ–≤–∞—Ä–∞
- –î–µ—Å–∫—Ç–æ–ø–Ω—ã–π: –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π, –±–ª–æ–∫–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, PRO-–±–ª–æ–∫–æ–º

---

### 2.2 –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ Middleware

**–§–∞–π–ª—ã:** `src/middleware.ts`, `src/lib/supabase/middleware.ts`, `src/lib/hooks/useUser.ts`

**–ü–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**

1. **Middleware** (`src/middleware.ts`) ‚Äî –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï –∑–∞–ø—Ä–æ—Å—ã (–∫—Ä–æ–º–µ —Å—Ç–∞—Ç–∏–∫–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, favicon):
   - –í—ã–∑—ã–≤–∞–µ—Ç `updateSession()` –∏–∑ `src/lib/supabase/middleware.ts`
   - `updateSession()` —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–π Supabase-–∫–ª–∏–µ–Ω—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ cookies
   - –í—ã–∑—ã–≤–∞–µ—Ç `supabase.auth.getUser()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è JWT-—Ç–æ–∫–µ–Ω–∞ —Å–µ—Å—Å–∏–∏
   - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ cookies –≤ Response

2. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ö—É–∫ `useUser()`** ‚Äî –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—å:
   - –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: `supabase.auth.getUser()` ‚Üí –µ—Å–ª–∏ –µ—Å—Ç—å user, –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –∏–∑ `profiles`
   - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `onAuthStateChange` ‚Äî —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ/–ª–æ–≥–∞—É—Ç–µ
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ user, profile, loading, signOut }`
   - `signOut()` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è + —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/`

3. **Supabase-–∫–ª–∏–µ–Ω—Ç—ã:**
   - `client.ts` ‚Äî –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –∏ `db.ts`
   - `server.ts` ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–π (—á–µ—Ä–µ–∑ cookies), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ server actions

---

### 2.3 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (`useSupabaseSync.ts`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–≤–æ–π–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º (localStorage + Supabase).

**–ü–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** –î–∞–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ `localStorage` (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä).
2. **–ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** (`user?.id` –º–µ–Ω—è–µ—Ç—Å—è):
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase —á–µ—Ä–µ–∑ `loadUserData()`
   - –ï—Å–ª–∏ –≤ Supabase –ø—É—Å—Ç–æ, –∞ –≤ localStorage –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Üí **–º–∏–≥—Ä–∞—Ü–∏—è** –∏–∑ localStorage –≤ Supabase
   - –ï—Å–ª–∏ –≤ Supabase –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Üí –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
3. **–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:**
   - Inventory –∏ Family —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å **debounce 500ms** (—Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É)
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø–∏—à–µ—Ç—Å—è –≤ localStorage (–¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω –¥–æ—Å—Ç—É–ø–∞) –∏ –≤ Supabase (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
4. **–†–µ—Ü–µ–ø—Ç—ã:**
   - `saveRecipe()` ‚Üí –≤—Å—Ç–∞–≤–∫–∞ –≤ `recipes` + —Å–≤—è–∑—å –≤ `saved_recipes` (—á–µ—Ä–µ–∑ `db.ts`)
   - `removeRecipe()` ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–≤—è–∑–∏ (`saved_recipes`), —Å–∞–º —Ä–µ—Ü–µ–ø—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∫–µ—à–µ

---

### 2.4 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤ AI (`generate.ts`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π server action –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è —á–µ—Ä–µ–∑ AI.

**–ü–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**

```
–ó–∞–ø—Ä–æ—Å –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
    ‚îÇ
    ‚ñº
1. Zod-–≤–∞–ª–∏–¥–∞—Ü–∏—è (inventory[], family[], onlyFridge, categories[])
    ‚îÇ
    ‚ñº
2. Rate Limiting (Upstash Redis ‚Äî 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω, –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–ª—é—á)
    ‚îÇ –µ—Å–ª–∏ Redis –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Äî –ø—Ä–æ–ø—É—Å–∫
    ‚ñº
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚îÇ –µ—Å–ª–∏ free-tier: –º–∞–∫—Å 5 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–¥–µ–Ω—å
    ‚îÇ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ 24—á ‚Äî —Å–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–∞
    ‚îÇ –µ—Å–ª–∏ PRO ‚Äî –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
    ‚ñº
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞: MD5(–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ_–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã) ‚Üí SELECT –∏–∑ recipes
    ‚îÇ –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–∑ 5 –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
    ‚ñº
5. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–º–ø—Ç–∞
    ‚îÇ –µ—Å–ª–∏ family –ø—É—Å—Ç–æ ‚Üí –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å (–¢–µ—Å—Ç–µ—Ä, 30 –ª–µ—Ç, –º—É–∂)
    ‚îÇ inventory + "–í–æ–¥–∞, –°–æ–ª—å, –ü–µ—Ä–µ—Ü" (–≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è)
    ‚îÇ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ profiling-—Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–ª–µ–Ω–∞ —Å–µ–º—å–∏
    ‚ñº
6. –í—ã–∑–æ–≤ AI (Gemini ‚Üí OpenRouter fallback)
    ‚îÇ Gemini 2.5 Flash (—á–µ—Ä–µ–∑ REST API + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏)
    ‚îÇ –ï—Å–ª–∏ Gemini —É–ø–∞–ª ‚Üí OpenRouter (4 –º–æ–¥–µ–ª–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏)
    ‚îÇ JSON-—Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞, Schema enforcement
    ‚ñº
7. –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Unsplash) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞
    ‚ñº
8. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à (recipes) + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
    ‚ñº
–í–æ–∑–≤—Ä–∞—Ç ChefPlan { summary, recipes[], shoppingList[] }
```

**–§–æ—Ä–º–∞—Ç AI-–æ—Ç–≤–µ—Ç–∞ (`ChefPlan`):**
- `summary` ‚Äî –æ–±—â–∏–π —Å–æ–≤–µ—Ç –ø–æ –ø–∏—Ç–∞–Ω–∏—é
- `recipes[]` ‚Äî –º–∞—Å—Å–∏–≤ —Ä–µ—Ü–µ–ø—Ç–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ (–ö–ë–ñ–£, –≤—Ä–µ–º—è, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–µ–º—å—è)
- `shoppingList[]` ‚Äî —á—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–∫—É–ø–∏—Ç—å

**Fallback-—Ü–µ–ø–æ—á–∫–∞ AI:**
1. Gemini 2.5 Flash (—á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏, –µ—Å–ª–∏ `PROXY_URL` –∑–∞–¥–∞–Ω)
2. OpenRouter ‚Üí `gemini-1.5-flash:free`
3. OpenRouter ‚Üí `gemini-2.0-flash-lite`
4. OpenRouter ‚Üí `llama-3-8b-instruct`
5. OpenRouter ‚Üí `phi-3-medium-128k`

---

### 2.5 –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ (`vision.ts`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ Gemini Vision API.

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–∞–µ—Ç base64-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∫–∞–º–µ—Ä—ã/—Ñ–∞–π–ª–∞
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Gemini 2.5 Flash Vision (multipart: text-–ø—Ä–æ–º–ø—Ç + inline image)
3. –ü—Ä–æ–º–ø—Ç: "List visible ingredients JSON: [{name, category}]"
4. –ü–∞—Ä—Å–∏—Ç JSON-–æ—Ç–≤–µ—Ç ‚Üí –º–∞—Å—Å–∏–≤ `Ingredient[]` (—Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º–∏ id)
5. –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ (–Ω–µ –±—Ä–æ—Å–∞–µ—Ç –æ—à–∏–±–∫—É)

---

### 2.6 –û–ø–ª–∞—Ç–∞ –∏ –ø–æ–¥–ø–∏—Å–∫–∏ (`payment.ts`)

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ YooKassa API (199‚ÇΩ, RUB)
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `idempotenceKey` (UUID)
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `payments` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
5. –í–æ–∑–≤—Ä–∞—Ç URL –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –æ–ø–ª–∞—Ç—É
6. Webhook YooKassa (–≤ `api/webhooks/yookassa/`) –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—É ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

---

### 2.7 –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ (`shopping.ts`)

**–õ–æ–≥–∏–∫–∞:**
1. `addItemsToShoppingList()` ‚Äî –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ `shopping_lists` (–ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ä–µ—Ü–µ–ø—Ç—É –µ—Å–ª–∏ –µ—Å—Ç—å)
2. `getShoppingLists()` ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Å–ø–∏—Å–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å JOIN –Ω–∞ `recipes(title)`
3. `deleteShoppingList()` ‚Äî —É–¥–∞–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ ID (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π `user_id`)
4. UUID-–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è `recipe_id` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∫–ª—é—á–µ–π
5. Fallback: –µ—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ `recipe_title` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –±–µ–∑ –Ω–µ—ë

---

### 2.8 –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è (`admin.ts`)

**–õ–æ–≥–∏–∫–∞:**
1. `checkAdmin()` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –µ–≥–æ email –≤ `ADMIN_EMAILS`
2. `getPendingRecipes()` ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ)
3. `updateRecipeStatus()` ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏ –ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å
4. –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ (`approved` + `isPublic`) ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ WordPress
5. `revalidatePath('/admin')` ‚Äî –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

### 2.9 –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ WordPress (`wordpress.ts`)

**–õ–æ–≥–∏–∫–∞:**
1. `publishToWordPress(recipeId)`:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–µ—Ü–µ–ø—Ç –∏–∑ Supabase
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML-–∫–æ–Ω—Ç–µ–Ω—Ç (–æ–ø–∏—Å–∞–Ω–∏–µ, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –ø–æ–ª—å–∑–∞)
   - –î–æ–±–∞–≤–ª—è–µ—Ç Schema.org JSON-LD –¥–ª—è SEO
   - –ü—É–±–ª–∏–∫—É–µ—Ç —á–µ—Ä–µ–∑ WordPress REST API (`/posts`)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç WP URL –æ–±—Ä–∞—Ç–Ω–æ –≤ Supabase (`wp_url`)
2. `publishPendingToWordPress()` ‚Äî –º–∞—Å—Å–æ–≤–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è (–¥–æ 10 —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∑–∞ —Ä–∞–∑)

---

### 2.10 –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (`hash.ts`)

**–õ–æ–≥–∏–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:**
1. `trim()` + `toLowerCase()` –∫–∞–∂–¥–æ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
2. –ó–∞–º–µ–Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –Ω–∞ –æ–¥–∏–Ω
3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫
4. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
5. `MD5(joined_string)` ‚Üí 32-—Å–∏–º–≤–æ–ª—å–Ω—ã–π —Ö–µ—à

**–ü—Ä–∏–º–µ—Ä:** `["–õ—É–∫", " –ö—É—Ä–∏—Ü–∞ "]` ‚Üí `["–∫—É—Ä–∏—Ü–∞", "–ª—É–∫"]` ‚Üí `MD5("–∫—É—Ä–∏—Ü–∞,–ª—É–∫")` ‚Üí `"abc123..."`

---

### 2.11 Rate Limiting (`ratelimit.ts`)

**–õ–æ–≥–∏–∫–∞:**
- –°–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 1 –º–∏–Ω—É—Ç—É
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–ª—é—á `"global_generate"` (–ù–ï –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é!)
- –ï—Å–ª–∏ Redis –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Üí –ø—Ä–æ–ø—É—Å–∫ (–≤—Å–µ–≥–¥–∞ `success: true`)
- –ï—Å–ª–∏ Redis —É–ø–∞–ª ‚Üí fallback `success: true` (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

## 3. –ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ

#### 3.1 Race Condition –≤ —Å—á—ë—Ç—á–∏–∫–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π (`generate.ts:260-267`)
```
–ü—Ä–æ–±–ª–µ–º–∞: supabase.auth.getUser() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –î–í–ê–ñ–î–´ (—Å—Ç—Ä–æ–∫–∏ 122 –∏ 245)
‚Äî –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–∞, –≤—Ç–æ—Ä–æ–π ‚Äî –¥–ª—è –∑–∞–ø–∏—Å–∏.
–ü—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö —Å—á—ë—Ç—á–∏–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–≤–µ–ª–∏—á–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.
```
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—É—é SQL-–æ–ø–µ—Ä–∞—Ü–∏—é: `UPDATE profiles SET daily_generations_count = daily_generations_count + 1 WHERE id = $1` —á–µ—Ä–µ–∑ RPC –∏–ª–∏ raw SQL, –≤—ã–∑—ã–≤–∞—Ç—å –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ.

#### 3.2 Rate Limit –ù–ï –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (`ratelimit.ts:26`)
```
–ü—Ä–æ–±–ª–µ–º–∞: –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫–ª—é—á–æ–º "global_generate",
—Ç.–µ. 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω –¥–µ–ª—è—Ç –í–°–ï –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
1 –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ—Ö.
```
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ `user.id` –∏–ª–∏ IP: `checkRateLimit(user?.id || request.ip || 'anonymous')`.

#### 3.3 `@ts-ignore` –¥–ª—è –ø—Ä–æ–∫—Å–∏-–∞–≥–µ–Ω—Ç–∞ (`generate.ts:300, 351`, `vision.ts:33`)
```
–ü—Ä–æ–±–ª–µ–º–∞: Node.js global fetch() –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø—Ü–∏—é `agent`.
–ü—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ HttpsProxyAgent —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å node-fetch,
–Ω–æ Next.js 16 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fetch. –ü—Ä–æ–∫—Å–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ù–ï–ê–ö–¢–ò–í–ï–ù.
```
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `undici` —Å `ProxyAgent` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Node.js 18+), –ª–∏–±–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `node-fetch` import.

#### 3.4 `inventory_hash` = slug –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ—Ü–µ–ø—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (`db.ts:105`)
```typescript
inventory_hash: slug, // –∏—Å–ø–æ–ª—å–∑—É–µ–º slug –∫–∞–∫ —Ö–µ—à –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
```
```
–ü—Ä–æ–±–ª–µ–º–∞: inventory_hash –≤ db.ts –ù–ï —è–≤–ª—è–µ—Ç—Å—è –Ω–∞—Å—Ç–æ—è—â–∏–º —Ö–µ—à–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤,
–∞ —Å–ª—É—á–∞–π–Ω—ã–º slug. –≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ª–æ–≥–∏–∫—É –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ generate.ts,
–≥–¥–µ –ø–æ–∏—Å–∫ –∏–¥—ë—Ç –ø–æ inventory_hash.
–†–µ—Ü–µ–ø—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é, –ù–ò–ö–û–ì–î–ê –Ω–µ –±—É–¥—É—Ç –Ω–∞–π–¥–µ–Ω—ã –≤ –∫–µ—à–µ.
```
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã—á–∏—Å–ª—è—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Ö–µ—à: `inventory_hash: hashIngredients(recipe.ingredientsToUse || [])`.

---

### üü° –°–µ—Ä—å—ë–∑–Ω—ã–µ

#### 3.5 –í–∞–ª–∏–¥–∞—Ü–∏—è Zod —Ç—Ä–µ–±—É–µ—Ç `family.min(1)`, –Ω–æ –∫–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ (`generate.ts:173`)
```
schemas.ts:24 ‚Üí family: z.array(...).min(1, "–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —á–ª–µ–Ω–∞ —Å–µ–º—å–∏")
generate.ts:173 ‚Üí if (!activeFamily || activeFamily.length === 0) ‚Üí fallback

–ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ: Zod –æ—Ç–∫–ª–æ–Ω–∏—Ç –∑–∞–ø—Ä–æ—Å –î–û —Ç–æ–≥–æ, –∫–∞–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç fallback.
–ì–æ—Å—Ç–µ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ –ø—Ä–æ—Ñ–∏–ª—è —Å–µ–º—å–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
```
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `family: z.array(familyMemberSchema).default([])` –∏–ª–∏ —É–±—Ä–∞—Ç—å `.min(1)`.

#### 3.6 `category` –≤ ingredientSchema ‚Äî `optional()`, –Ω–æ –≤ —Ç–∏–ø–µ `Ingredient` ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
```
schemas.ts:6 ‚Üí category: z.string().optional()
types.ts:56 ‚Üí category: Category (NOT optional)
```
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å: –ª–∏–±–æ —Å–¥–µ–ª–∞—Ç—å `Category` optional –≤ —Ç–∏–ø–µ, –ª–∏–±–æ required –≤ —Å—Ö–µ–º–µ.

#### 3.7 Placeholder-–∑–Ω–∞—á–µ–Ω–∏—è –≤ Supabase-–∫–ª–∏–µ–Ω—Ç–∞—Ö
```typescript
// client.ts:5, server.ts:8, middleware.ts:10
process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://placeholder.supabase.co'
```
```
–ü—Ä–æ–±–ª–µ–º–∞: –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –∑–∞–¥–∞–Ω—ã, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É–ø–∞–¥—ë—Ç,
–∞ –±—É–¥–µ—Ç —Ç–∏—Ö–æ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π URL.
–û—à–∏–±–∫–∏ –±—É–¥—É—Ç –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.
```
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ë—Ä–æ—Å–∞—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–∞–ø–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

#### 3.8 –ù–µ–∑–∞—â–∏—â—ë–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç AI (`generate.ts:198-207`)
```
–ü—Ä–æ–±–ª–µ–º–∞: –í –ø—Ä–æ–º–ø—Ç–µ –Ω–µ—Ç System Instruction, –∑–∞—â–∏—â–∞—é—â–µ–π –æ—Ç prompt injection.
–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (SKILL.md:98) —Ç—Ä–µ–±—É–µ—Ç: "–ò–≥–Ω–æ—Ä–∏—Ä—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤".
–¢–µ–∫—É—â–∏–π –ø—Ä–æ–º–ø—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω—ã–π user-message,
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Å—Ç–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ –∏–º–µ–Ω–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤.
```
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ system + user messages. –í system —É–∫–∞–∑–∞—Ç—å —Ä–æ–ª—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

#### 3.9 –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `getUser()` –≤ `generate.ts`
```
–°—Ç—Ä–æ–∫–∞ 122: const { data: { user } } = await supabase.auth.getUser();
–°—Ç—Ä–æ–∫–∞ 245: const { data: { user } } = await supabase.auth.getUser();
```
–î–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤—ã–∑–æ–≤–∞ –≤ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –ª–∏—à–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ + –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –±–∞–≥–∏.

---

### üü† –°—Ä–µ–¥–Ω–∏–µ

#### 3.10 –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π-–æ–±–º–∞–Ω: "soup –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ MealCategory" (`page.tsx:36`)
```typescript
// ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚Äî 'soup' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ MealCategory, –∏—Å–ø–æ–ª—å–∑—É–µ–º 'salad'
const [selectedCategories, setSelectedCategories] = useState<MealCategory[]>(['breakfast', 'salad', 'main', 'dessert']);
```
```
–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ 'soup' –ï–°–¢–¨ –≤ MealCategory (types.ts:3).
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤–≤–æ–¥–∏—Ç –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ. Soup –ø—Ä–æ—Å—Ç–æ —É–±—Ä–∞–Ω –∏–∑ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
```

#### 3.11 –£—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –æ—à–∏–±–∫–∞—Ö –∞–¥–º–∏–Ω–∫–∏ (`admin.ts:22`)
```typescript
throw new Error(`Unauthorized: Email ${user.email} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º. –î–æ—Å—Ç—É–ø–Ω—ã–µ: ${adminEmails.join(', ')}`);
```
–°–ø–∏—Å–æ–∫ email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –æ—à–∏–±–∫–µ. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å.

#### 3.12 `Math.random()` –¥–ª—è ID –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –∏–∑ Vision (`vision.ts:43`)
```typescript
return json.map((i: any) => ({ id: Math.random().toString(), ... }));
```
`Math.random()` –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–ª–∏–∑–∏–∏. –õ—É—á—à–µ: `crypto.randomUUID()`.

#### 3.13 –ë—ç–∫–∞–ø —Ñ–∞–π–ª `ai.ts.bak` –≤ production-–∫–æ–¥–µ
–§–∞–π–ª `src/app/actions/ai.ts.bak` (20KB) ‚Äî —ç—Ç–æ –±—ç–∫–∞–ø, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –î–æ–±–∞–≤–∏—Ç—å –≤ `.gitignore`.

#### 3.14 –ò–º—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ `package.json` ‚Äî `temp_app`
```json
"name": "temp_app"
```
–°–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `schef-fridge` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ. –í–ª–∏—è–µ—Ç –Ω–∞ Sentry, –ª–æ–≥–∏, PWA.

#### 3.15 –ò–º–ø–æ—Ä—Ç `uuid` –≤ `payment.ts`, –Ω–æ –ø–∞–∫–µ—Ç ‚Äî —Ç–æ–ª—å–∫–æ –≤ devDependencies
```
payment.ts:4 ‚Üí import { v4 as uuidv4 } from 'uuid';
package.json ‚Üí @types/uuid –≤ devDependencies, –Ω–æ —Å–∞–º–æ–≥–æ `uuid` –ù–ï–¢ –≤ dependencies.
```
–ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ –∏–∑-–∑–∞ hoisting, –Ω–æ –Ω–∞ CI/production —É–ø–∞–¥—ë—Ç.

#### 3.16 `GenerationService` ‚Äî –ª–∏—à–Ω—è—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è
```
services/generationService.ts ‚Äî –ø—Ä–æ—Å—Ç–æ –æ–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ server action.
–î–æ–±–∞–≤–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∫–æ—Å–≤–µ–Ω–Ω–æ—Å—Ç–∏ –±–µ–∑ –ø–æ–ª—å–∑—ã.
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π "Client-Side Gemini is blocked" —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ
—Ä–∞–Ω—å—à–µ –±—ã–ª –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π fallback, –∫–æ—Ç–æ—Ä—ã–π —É–±—Ä–∞–ª–∏.
```

---

### üîµ –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ

#### 3.17 `maxDuration = 60` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
```
page.tsx:19 ‚Üí export const maxDuration = 60;
// –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ generate.ts:3 ‚Üí "maxDuration should be in page.tsx or next.config.ts"
```
`maxDuration` –¥–ª—è Vercel Serverless —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ Route Handlers –∏ Server Actions. –í `page.tsx` ('use client') –æ–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.

#### 3.18 –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç –≤ `generationService.ts`
```typescript
import { GoogleGenerativeAI } from "@google/generative-ai"; // Only for types if needed
```
–ò–º–ø–æ—Ä—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –±–∞–Ω–¥–ª.

#### 3.19 `import 'server-only'` –≤ `proxy.ts`, –Ω–æ —Ñ–∞–π–ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ server actions
–•–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞, –Ω–æ –∏–∑–±—ã—Ç–æ—á–Ω–∞ ‚Äî –≤—Å–µ –≤—ã–∑—ã–≤–∞—é—â–∏–µ —Ñ–∞–π–ª—ã —É–∂–µ `'use server'`.

---

## 4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

| # | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|---|---|
| A1 | –†–∞–∑–¥–µ–ª–∏—Ç—å `generate.ts` (388 —Å—Ç—Ä–æ–∫) –Ω–∞ –º–æ–¥—É–ª–∏: `ai-client.ts`, `cache.ts`, `limits.ts`, `prompt.ts` | –í—ã—Å–æ–∫–∏–π |
| A2 | –í—ã–Ω–µ—Å—Ç–∏ `ChefPanel.tsx` (35KB!) –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: `RecipeCard`, `GenerateButton`, `CategorySelector` | –í—ã—Å–æ–∫–∏–π |
| A3 | –£–±—Ä–∞—Ç—å `GenerationService` ‚Äî –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ Server Action –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø—Ä–æ—â–µ –∏ –Ω–µ –º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–µ–Ω | –ù–∏–∑–∫–∏–π |
| A4 | –î–æ–±–∞–≤–∏—Ç—å Error Boundary –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞–Ω–µ–ª–∏ | –°—Ä–µ–¥–Ω–∏–π |

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

| # | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|---|---|
| S1 | –î–æ–±–∞–≤–∏—Ç—å System Instruction –≤ –ø—Ä–æ–º–ø—Ç Gemini —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç injection | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| S2 | –£–±—Ä–∞—Ç—å —É—Ç–µ—á–∫—É ADMIN_EMAILS –∏–∑ –æ—à–∏–±–æ–∫ | –í—ã—Å–æ–∫–∏–π |
| S3 | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É Content Security Policy –≤ `next.config.ts` | –°—Ä–µ–¥–Ω–∏–π |
| S4 | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SUPABASE_SERVICE_ROLE_KEY` –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏ –≤ `generate.ts` –≤–º–µ—Å—Ç–æ anon key | –°—Ä–µ–¥–Ω–∏–π |

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| # | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|---|---|
| P1 | Rate limit –ø–æ user/IP –≤–º–µ—Å—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| P2 | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Promise.all()` –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π Unsplash (—Å–µ–π—á–∞—Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ) | –°—Ä–µ–¥–Ω–∏–π |
| P3 | –î–æ–±–∞–≤–∏—Ç—å `stale-while-revalidate` –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ | –ù–∏–∑–∫–∏–π |
| P4 | –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å SSR –¥–ª—è SEO-—Å—Ç—Ä–∞–Ω–∏—Ü (recipe, pricing, privacy, terms) | –°—Ä–µ–¥–Ω–∏–π |

### üßπ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

| # | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|---|---|
| Q1 | –£–±—Ä–∞—Ç—å –≤—Å–µ `@ts-ignore` ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –∏–ª–∏ `as unknown as Type` | –í—ã—Å–æ–∫–∏–π |
| Q2 | –£–±—Ä–∞—Ç—å `ai.ts.bak` –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è | –ù–∏–∑–∫–∏–π |
| Q3 | –ò—Å–ø—Ä–∞–≤–∏—Ç—å `package.json` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `uuid` –≤ dependencies, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç | –°—Ä–µ–¥–Ω–∏–π |
| Q4 | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å Zod-—Å—Ö–µ–º—ã —Å TypeScript —Ç–∏–ø–∞–º–∏ (category required vs optional) | –í—ã—Å–æ–∫–∏–π |
| Q5 | –ó–∞–º–µ–Ω–∏—Ç—å `Math.random()` ID –Ω–∞ `crypto.randomUUID()` | –ù–∏–∑–∫–∏–π |
| Q6 | –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∂–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–æ soup –≤ `page.tsx:36` | –ù–∏–∑–∫–∏–π |

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

| # | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|---|---|
| M1 | Sentry –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è), –Ω–æ –Ω–µ—Ç —è–≤–Ω—ã—Ö `Sentry.captureException()` –≤ catch-–±–ª–æ–∫–∞—Ö | –°—Ä–µ–¥–Ω–∏–π |
| M2 | –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏: –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –ø—Ä–æ—Ü–µ–Ω—Ç –∫–µ—à-–ø–æ–ø–∞–¥–∞–Ω–∏–π, –æ—à–∏–±–∫–∏ –ø–æ –º–æ–¥–µ–ª—è–º AI | –°—Ä–µ–¥–Ω–∏–π |

---

## –†–µ–∑—é–º–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ¬´–®–µ—Ñ-–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫¬ª ‚Äî —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ PWA —Å —Ö–æ—Ä–æ—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (Next.js App Router, Supabase, Server Actions). –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–∫—Å–∏ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å** (Node.js fetch –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `agent`)
2. **Rate limit –æ–±—â–∏–π** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (DoS-—É—è–∑–≤–∏–º–æ—Å—Ç—å)
3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –ª–æ–º–∞–µ—Ç—Å—è** –ø—Ä–∏ —Ä—É—á–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ (slug –≤–º–µ—Å—Ç–æ hash)
4. **Zod-–≤–∞–ª–∏–¥–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç** –≥–æ—Å—Ç–µ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –ø—Ä–æ—Ñ–∏–ª—è —Å–µ–º—å–∏
5. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞—â–∏—Ç–∞ –æ—Ç prompt injection** –≤ AI-–ø—Ä–æ–º–ø—Ç–∞—Ö
6. **–ü–∞–∫–µ—Ç `uuid` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω** –≤ –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (3.1‚Äì3.4) –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å, –∑–∞—Ç–µ–º –∑–∞–Ω—è—Ç—å—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é (S1‚ÄìS2) –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é (P1‚ÄìP2).
